# 5장. 웹 서버 리팩토링, 서블릿 컨테이너와 서블릿의 관계

리팩토링을 하는데 있어 리팩토링이 필요한 시점과 종료해야하는 시점을 판단해야 하는
능력이 중요하다. 다른 사람이 구현한 코드를 많이 읽어보고 소스 코드를 직접 구현해가며 경험을 쌓아보자

## 웹 서버 리팩토링 실습

### 요청 데이터를 처리하는 로직을 별도의 클래스로 분리한다

클라이언트의 요청 데이터에서 요청 라인을 읽고, 헤더를 읽는 로직을 별도의 클래스로 분리한다.

해당 클래스는 단순히 요청 데이터를 읽어 사용하기 쉬운 형태로 분리하는 역할을 담당하고,
실제 사용은 RequestHandler에서 담당한다.

### 응답 데이터를 처리하는 로직을 별도의 클래스로 분리한다

응답 데이터의 상태에 따라 적절한 HTTP 헤더를 처리하는 부분을 추가한다.
HTML, CSS, 자바스크립트 파일을 읽어 반환하는 부분과 302 상태 코드를 처리하는 부분이
가능해야하며, 쿠키 추가와 같이 HTTP 헤더에 임의의 값을 추가할 수 있어야한다.

### 다형성을 활용해 클라이언트 요청 URL에 대한 분기 처리를 제거

RequestHandler 내 run 메서드의 단점은 기능이 추가될 때마다 else if 절이 추가되는 구조로 구현되어 있는 것이다.
이는 객체 지향 설계 원칙 중 OCP(Operation-Closed Principle)를 위반하는 것이다.

Controller라는 interface를 통해 새로운 기능이 추가된다면 더이상 run 메서드에 분기문을 추가할 필요가 없어졌다.
RequestMapping에 URL과 Controller를 매핑하는 방식으로 기능을 추가할 수 있게 되었다.

한발 더 나아가 HTTP 메서드에 따라 다른 처리를 할 수 있도록 추상 클래스를 추가할 수도 있다.

### HTTP 웹 서버의 문제점

- HTTP 요청과 응답 헤더, 본문 처리와 같은 데 시간을 투자함으로써 서비스 로직에 투자하는 시간이 줄어든다
- 동적인 HTML을 지원하는데 한계가 있다
- 사용자가 입력한 데이터가 서버를 재시작하면 사라진다.