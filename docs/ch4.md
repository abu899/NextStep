# 웹서버 구현

클라이언트에서 서버로 전송하는 데이터가 어떻게 구성되었는지 확인해야한다.
 
## HTTP 요청과 응답

### 요청 (Request)

- 요청 데이터의 첫 번쨰 라인은 요청 라인(request line)
- 두 번째 라인부터 빈 공백 문자열 라인까지는 요청 헤더(request header)
- 빈 공백 문자열 다음부터 본문(body) -> optional

HTTP 요청에서 요청 라인, 요청 헤더, 빈 공백 문자열까지는 필수이고, 요청 본문은 선택 사항이다.

#### 요청 라인

- `HTTP 요청 메서드 / URI / HTTP 버젼` 으로 구성

#### 요청 헤더

- 요청 헤더는 `헤더 이름: 헤더 값` 형식으로 구성

### 응답(Response)

- 응답 메시지의 첫 번째 라인은 상태 라인(status line)
- 두 번째 라인부터 빈 공백 문자열 라인까지 응답 헤더(response header)
- 빈 공백 문자열 다음부터 본문(body) -> optional

#### 상태 라인

- `HTTP 버전 / 상태 코드 / 응답구문` 형식으로 구성

## index.html 응답하기

- /index.html 요청을 한번 보냈는데 여러 개의 추가 요청이 발생할 수 있다
  - 서버가 웹 페이지를 구성하는 모든 자원을 한번에 응답으로 보내지 않기 때문

## GET 방식으로 회원가입하기

- GET 방식 회원가입 기능을 구현하려면 경로와 쿼리 스트링을 분리해야 한다
- GET 방식으로 입력한 데이터를 전달하는데는 몇가지 문제가 존재
  - 사용자가 입력한 데이터가 브라우저 URL 입력창에 노출
  - 요청 라인의 길이 제한

### POST 방식으로 회원가입하기

- 헤더에 포함된 Content-Length 값은 요청 본문의 길이를 구한다
- 구한 길이 만큼 본문을 읽어서 map 형태로 변환하여 데이터를 구한다

GET은 서버에 존재하는 데이터를 가져오는 것이고, POST는 서버에 요청을 보내 데이터
추가, 수정, 삭제같은 작업을 실행한다.

### 302 status code 적용

회원가입이 완료된 이후 index.html로 보내고 싶을 때 기존 200 OK 상태 코드만 보내면 어떻게 될까?

이렇게 처리하는 경우, 새로 고침을 하게 되면 이전과 똑같은 회원가입 요청이 발생한다.
원인은 브라우저가 이전 요청 정보를 유지하고 있기 떄문이다.

이 문제를 해결하기 위해선 302 상태 코드를 활용해 해결 가능하다. 302 상태 코드의 경우
응답 헤더에 `Location 헤더`를 포함시켜 리다이렉트 시킬 주소를 포함시킨다.
302 상태 코드를 활용하면 다음과 같은 흐름으로 진행된다.

1. /user/create 요청
2. 회원가입 처리
3. index.html로 302 응답
4. index.html 요청
5. index.thml 200 응답

위를 살펴보면, 302 상태 코드를 활용해 페이지를 이동할 경우 요청과 응답이 두번 발생한다.

302처럼 대표적으로 사용되는 상태 코드는 다음과 같다

- 2XX: 성공
  - 클라이언트가 요청한 동작을 성공적으로 처리
- 3XX: 리다이렉션 완료
  - 클라이언트는 요청을 완료하기 위해 추가 동작을 취해야 함
- 4XX: 요청 오류
  - 클라이언트가 잘못된 요청을 보냄
- 5XX: 서버 오류
  - 서버가 유효한 요청을 처리하지 못함

## 로그인 하기

응답 헤더에 Set-Cookie 헤더가 존재하는 경우 브라우저는 Set-Cookie 값을 읽어
서버에 보내는 요청 헤더에 Cookie 헤더 값으로 다시 전송한다.